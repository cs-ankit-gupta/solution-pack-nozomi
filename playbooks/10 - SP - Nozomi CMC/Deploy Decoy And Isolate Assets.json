{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Deploy Decoy And Isolate Assets",
    "aliasName": null,
    "tag": null,
    "description": "This PB will deploy decoy on assets and will isolates assets",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/566483c2-686f-4c7d-b8df-eb51583b1814",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/1eb3ae33-0b11-4959-97fd-25c6c5ada67c",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "6c4cee8c-8f34-4cb8-b9e2-4008024eefb1",
                "resources": [
                    "alerts"
                ],
                "inputVariables": [],
                "step_variables": {
                    "input": {
                        "params": [],
                        "records": "{{vars.input.records}}"
                    }
                },
                "displayConditions": {
                    "alerts": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": []
                    }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "singleRecordExecution": true
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "group": null,
            "uuid": "1eb3ae33-0b11-4959-97fd-25c6c5ada67c"
        },
        {
            "@type": "WorkflowStep",
            "name": "Set UUID With Decoy Id",
            "description": null,
            "arguments": {
                "commentResult": "{% set data = vars.decoyResult %}{% for item in vars.decoyResult %}{% set iri = vars.assetList | json_query(\"[?hostname == '\"+item.instance_name+\"'].uuid\")  %}{% set _ = item.update({\"iri\":\"\/api\/3\/assets\/\" + iri[0]}) %}{% endfor %}{{data}}"
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "32c66aca-f19d-4873-94ae-4c93c3856c01"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update Asset State",
            "description": null,
            "arguments": {
                "message": {
                    "tags": [
                        "\/api\/3\/tags\/Isolate"
                    ],
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "tenant": "",
                    "thread": false,
                    "content": "<p>Isolated because found in malicious activity: <a href=\"\/modules\/alerts\/{{vars.input.records[0].uuid}}\" target=\"_blank\" rel=\"noopener\">{{vars.input.records[0].name}}<\/a><\/p>",
                    "records": "{{vars.assetList | json_query('[*][\"@id\"][]') }}"
                },
                "for_each": {
                    "item": "{{vars.assetList}}",
                    "__bulk": true,
                    "parallel": false,
                    "condition": "",
                    "batch_size": 100
                },
                "resource": {
                    "state": "\/api\/3\/picklists\/321ad354-42ce-42b6-8636-2fa184a7dcd5"
                },
                "operation": "Append",
                "collection": "{{vars.item[\"@id\"]}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/assets",
                "fieldOperation": {
                    "protocol": "Append",
                    "recordTags": "Append"
                },
                "step_variables": []
            },
            "status": null,
            "top": "300",
            "left": "640",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "6348ff62-8154-4f10-834d-4cf035b3cd7b"
        },
        {
            "@type": "WorkflowStep",
            "name": "Deploy Decoy",
            "description": null,
            "arguments": {
                "name": "Fortinet FortiDeceptor",
                "config": "895c762a-af67-4a80-9bad-92642b295172",
                "params": {
                    "dns": "8.8.8.8",
                    "name": "{{vars.item.hostname}}",
                    "hostname": "{{vars.item.hostname}}",
                    "interfaces": "[\n  {\n    \"ips\": [\n      \"10.132.255.1\",\n      \"10.132.255.255\"\n    ],\n    \"gateway\": \"10.132.255.1\",\n    \"deploynet_id\": \"3024284861624447605\",\n    \"static_ipcount\": 2,\n    \"addressing_mode\": \"static\"\n  }\n]",
                    "template_id": "{{vars.templateID}}"
                },
                "version": "1.0.0",
                "for_each": {
                    "item": "{{vars.assetList}}",
                    "__bulk": false,
                    "parallel": true,
                    "condition": ""
                },
                "connector": "fortinet-fortideceptor",
                "operation": "decoy_deploy",
                "mock_result": "{\n  \"result\": [\n    {\n      \"data\": {\n        \"result\": {\n          \"instance_id\": \"3053551759739313504\",\n          \"instance_name\": \"fsr-prod-win10\"\n        },\n        \"status\": {\n          \"return_code\": 1\n        }\n      },\n      \"status\": \"Success\",\n      \"message\": \"\",\n      \"operation\": null\n    },\n    {\n      \"data\": {\n        \"result\": {\n          \"instance_id\": \"3053551760004480585\",\n          \"instance_name\": \"FSR-PROD-WIN10\"\n        },\n        \"status\": {\n          \"return_code\": 1\n        }\n      },\n      \"status\": \"Success\",\n      \"message\": \"\",\n      \"operation\": null\n    }\n  ],\n  \"execution_time\": \"572 ms\",\n  \"status\": \"finished\"\n}",
                "operationTitle": "Deploy Decoy",
                "pickFromTenant": false,
                "step_variables": {
                    "decoyResult": "{{vars.steps.Deploy_Decoy['result'] | json_query('[*][\"data\"][][\"result\"][]')}}"
                }
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "92823c06-9d0b-4343-936a-092c9f27a8bf"
        },
        {
            "@type": "WorkflowStep",
            "name": "Raise ServiceNow Ticket",
            "description": null,
            "arguments": {
                "name": "ServiceNow",
                "config": "0323f23c-3069-4e5b-b350-213e510d6bcc",
                "params": {
                    "state": "",
                    "impact": "1",
                    "urgency": "1",
                    "category": "",
                    "location": "",
                    "severity": "1",
                    "caller_id": "{{vars.loggedInUserName}}",
                    "work_notes": "",
                    "assigned_to": "{{vars.loggedInUserName}}",
                    "description": "",
                    "other_fields": "",
                    "assignment_group": "",
                    "short_description": "The asset has been quarantined; please take the appropriate action."
                },
                "version": "3.2.0",
                "connector": "servicenow",
                "operation": "create_incident",
                "mock_result": "{\n  \"data\": {\n    \"result\": {\n      \"rfc\": \"\",\n      \"order\": \"\",\n      \"state\": \"2\",\n      \"active\": \"true\",\n      \"impact\": \"1\",\n      \"notify\": \"1\",\n      \"number\": \"INC0010001\",\n      \"parent\": \"\",\n      \"skills\": \"\",\n      \"sys_id\": \"\",\n      \"cmdb_ci\": \"\",\n      \"company\": \"\",\n      \"sla_due\": \"\",\n      \"urgency\": \"1\",\n      \"approval\": \"not requested\",\n      \"category\": \"inquiry\",\n      \"comments\": \"\",\n      \"contract\": \"\",\n      \"due_date\": \"\",\n      \"location\": \"\",\n      \"made_sla\": \"true\",\n      \"priority\": \"1\",\n      \"severity\": \"1\",\n      \"sys_tags\": \"\",\n      \"work_end\": \"\",\n      \"caller_id\": {\n        \"link\": \"\",\n        \"value\": \"\"\n      },\n      \"caused_by\": \"\",\n      \"closed_at\": \"\",\n      \"closed_by\": \"\",\n      \"follow_up\": \"\",\n      \"knowledge\": \"false\",\n      \"opened_at\": \"\",\n      \"opened_by\": {\n        \"link\": \"\",\n        \"value\": \"\"\n      },\n      \"close_code\": \"\",\n      \"escalation\": \"0\",\n      \"group_list\": \"\",\n      \"problem_id\": \"\",\n      \"sys_domain\": {\n        \"link\": \"\",\n        \"value\": \"\"\n      },\n      \"user_input\": \"\",\n      \"watch_list\": \"\",\n      \"work_notes\": \"\",\n      \"work_start\": \"\",\n      \"assigned_to\": {\n        \"link\": \"\",\n        \"value\": \"\"\n      },\n      \"close_notes\": \"\",\n      \"description\": \"\",\n      \"hold_reason\": \"\",\n      \"reopened_by\": \"\",\n      \"resolved_at\": \"\",\n      \"resolved_by\": \"\",\n      \"subcategory\": \"\",\n      \"time_worked\": \"\",\n      \"upon_reject\": \"cancel\",\n      \"activity_due\": \"\",\n      \"approval_set\": \"\",\n      \"business_stc\": \"\",\n      \"calendar_stc\": \"\",\n      \"contact_type\": \"\",\n      \"reopen_count\": \"0\",\n      \"route_reason\": \"\",\n      \"delivery_plan\": \"\",\n      \"delivery_task\": \"\",\n      \"reopened_time\": \"\",\n      \"sys_mod_count\": \"0\",\n      \"upon_approval\": \"proceed\",\n      \"correlation_id\": \"\",\n      \"expected_start\": \"\",\n      \"incident_state\": \"2\",\n      \"sys_class_name\": \"incident\",\n      \"sys_created_by\": \"admin\",\n      \"sys_created_on\": \"2023-01-04 13:27:20\",\n      \"sys_updated_by\": \"admin\",\n      \"sys_updated_on\": \"2023-01-04 13:27:20\",\n      \"child_incidents\": \"0\",\n      \"parent_incident\": \"\",\n      \"sys_domain_path\": \"\/\",\n      \"work_notes_list\": \"\",\n      \"approval_history\": \"\",\n      \"assignment_group\": \"\",\n      \"business_service\": \"\",\n      \"service_offering\": \"\",\n      \"business_duration\": \"\",\n      \"calendar_duration\": \"\",\n      \"short_description\": \"The asset has been quarantined; please take the appropriate action.\",\n      \"universal_request\": \"\",\n      \"reassignment_count\": \"0\",\n      \"correlation_display\": \"\",\n      \"task_effective_number\": \"INC0010001\",\n      \"comments_and_work_notes\": \"\",\n      \"additional_assignee_list\": \"\"\n    }\n  },\n  \"status\": \"Success\",\n  \"message\": \"\",\n  \"operation\": null\n}",
                "operationTitle": "Create Incident",
                "pickFromTenant": false,
                "step_variables": []
            },
            "status": null,
            "top": "440",
            "left": "640",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "989b03f8-ce72-45c3-b161-53a2955374aa"
        },
        {
            "@type": "WorkflowStep",
            "name": "Add Comment On Asset",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.commentResult}}",
                    "__bulk": true,
                    "parallel": false,
                    "condition": "",
                    "batch_size": 100
                },
                "resource": {
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "assets": "{{vars.item.iri}}",
                    "people": [],
                    "content": "<p>Deployed FortiDeceptor Decoy with Instance id: <span class=\"badge badge-pill badge-danger\" style=\"background: #009d00; color: #fff;\">{{vars.item.instance_id}}<\/span> and Instance Name: <span class=\"badge badge-pill badge-danger\" style=\"background: #009d00; color: #fff;\">{{vars.item.instance_name}}<\/span><\/p>",
                    "__replace": "",
                    "isImportant": true,
                    "peopleUpdated": false
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/comments",
                "__recommend": [],
                "fieldOperation": {
                    "protocol": "Overwrite",
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "40",
            "left": "640",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "b6ffd179-c567-4b6c-84bb-bdb7d486edb1"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "templateID": "3050921492680610041",
                "useMockOutput": "{{globalVars.Demo_mode}}",
                "loggedInUserName": "{% set user = vars.request.currentUser | fromIRI %}{{user.firstname}}{{user.lastname}}"
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "e957a900-935c-4de0-83cc-bdc2a2e83f73"
        },
        {
            "@type": "WorkflowStep",
            "name": "Add Decoy Comment On Alert",
            "description": null,
            "arguments": {
                "resource": {
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "alerts": "{{vars.input.records[0]['@id']}}",
                    "people": [],
                    "content": "<p>Deployed FortiDeceptor Decoy:<\/p>\n<p>{% for item in vars.commentResult %}<\/p>\n<ul>\n<li><a href=\"\/modules\/assets\/{{item.iri.split('\/')[-1]}}\" target=\"_blank\" rel=\"noopener\"> {{(item.iri | fromIRI).hostname}}<\/a> - {{item.instance_id}} - {{item.instance_name}}<\/li>\n<\/ul>\n<p>{% endfor %}<\/p>",
                    "__replace": "",
                    "isImportant": true,
                    "peopleUpdated": false
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/comments",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "580",
            "left": "1020",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "f2b81314-5d35-4580-a8bb-c1002bb3fc15"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Assets",
            "description": null,
            "arguments": {
                "query": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": [
                        {
                            "type": "primitive",
                            "field": "uuid",
                            "value": "{{vars.input.records[0].uuid}}",
                            "operator": "eq",
                            "_operator": "eq"
                        }
                    ],
                    "__selectFields": [
                        "assets"
                    ]
                },
                "module": "alerts?$limit=30&$relationships=true&$fsr_max_relation_count=100",
                "checkboxFields": true,
                "step_variables": {
                    "assetList": "{{vars.steps.Get_Assets[0].assets}}"
                }
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928770",
            "group": null,
            "uuid": "f9fe78b7-4fc1-4b60-8f85-c530507ef578"
        },
        {
            "@type": "WorkflowStep",
            "name": "Add Asset Comment On Alert",
            "description": null,
            "arguments": {
                "resource": {
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "alerts": "{{vars.input.records[0]['@id']}}",
                    "people": [],
                    "content": "<p>Isolated Following Assets and Raised ServiceNow Ticket : <span class=\"badge badge-pill badge-danger\" style=\"background: #009d00; color: #fff;\">{{vars.steps.Raise_ServiceNow_Ticket.data.result.number}}<\/span><\/p>\n<p>{% for asset in vars.assetList %}<\/p>\n<p><a href=\"\/modules\/assets\/{{asset.uuid}}\" target=\"_blank\" rel=\"noopener\">{{asset.hostname}}<\/a><\/p>\n<p>{% endfor %}<\/p>",
                    "__replace": "",
                    "isImportant": false,
                    "peopleUpdated": false
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/comments",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "580",
            "left": "640",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "fb4b811b-088c-4de1-9887-7e366552aae4"
        },
        {
            "@type": "WorkflowStep",
            "name": "Quarantine Asset In FortiEDR",
            "description": null,
            "arguments": {
                "name": "Fortinet FortiEDR",
                "config": "a6fdf914-7190-4c2f-bbb0-29469ad5d6a4",
                "params": {
                    "type": "Name",
                    "devices": "{{vars.item.hostname}}",
                    "organization": ""
                },
                "version": "1.3.1",
                "for_each": {
                    "item": "{{vars.assetList}}",
                    "parallel": false,
                    "condition": ""
                },
                "connector": "fortinet-fortiedr",
                "operation": "isolate_collector",
                "mock_result": "{\n  \"data\": {\n    \"result\": \"Successfully executed isolate_collector\"\n  },\n  \"status\": \"Success\",\n  \"_status\": true,\n  \"message\": \"\",\n  \"operation\": null,\n  \"request_id\": null\n}",
                "operationTitle": "Isolate Collector",
                "pickFromTenant": false,
                "step_variables": []
            },
            "status": null,
            "top": "160",
            "left": "640",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "feb28d35-726c-47cc-86eb-b31a58abf27a"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Raise ServiceNow Ticket -> Add Comment On Alert",
            "targetStep": "\/api\/3\/workflow_steps\/fb4b811b-088c-4de1-9887-7e366552aae4",
            "sourceStep": "\/api\/3\/workflow_steps\/989b03f8-ce72-45c3-b161-53a2955374aa",
            "label": null,
            "isExecuted": false,
            "uuid": "1a6790ec-942b-4493-83bf-99fd5aa341c3"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Set UUID With Decoy Id -> Add Comment On Asset",
            "targetStep": "\/api\/3\/workflow_steps\/b6ffd179-c567-4b6c-84bb-bdb7d486edb1",
            "sourceStep": "\/api\/3\/workflow_steps\/32c66aca-f19d-4873-94ae-4c93c3856c01",
            "label": null,
            "isExecuted": false,
            "uuid": "1ea1590e-c1be-43fe-a640-bfe3ba915fc0"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/e957a900-935c-4de0-83cc-bdc2a2e83f73",
            "sourceStep": "\/api\/3\/workflow_steps\/1eb3ae33-0b11-4959-97fd-25c6c5ada67c",
            "label": null,
            "isExecuted": false,
            "uuid": "27cca453-f89e-4c6d-871d-abdaca340dd2"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Assets -> Deploy Decoy",
            "targetStep": "\/api\/3\/workflow_steps\/92823c06-9d0b-4343-936a-092c9f27a8bf",
            "sourceStep": "\/api\/3\/workflow_steps\/f9fe78b7-4fc1-4b60-8f85-c530507ef578",
            "label": null,
            "isExecuted": false,
            "uuid": "5afc93b0-6447-4c3b-93f6-f7e16881696e"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Update Asset State -> Raise ServiceNow Ticket",
            "targetStep": "\/api\/3\/workflow_steps\/989b03f8-ce72-45c3-b161-53a2955374aa",
            "sourceStep": "\/api\/3\/workflow_steps\/6348ff62-8154-4f10-834d-4cf035b3cd7b",
            "label": null,
            "isExecuted": false,
            "uuid": "657fb263-6564-4b3d-b0a7-3da653b5fb32"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Add Comment On Asset -> Quarantine Asset In FortiEDR",
            "targetStep": "\/api\/3\/workflow_steps\/feb28d35-726c-47cc-86eb-b31a58abf27a",
            "sourceStep": "\/api\/3\/workflow_steps\/b6ffd179-c567-4b6c-84bb-bdb7d486edb1",
            "label": null,
            "isExecuted": false,
            "uuid": "8a2ee6ad-a23f-42c0-a96b-38f82ed0872f"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Add Asset Comment On Alert -> Add Decoy Comment On Alert",
            "targetStep": "\/api\/3\/workflow_steps\/f2b81314-5d35-4580-a8bb-c1002bb3fc15",
            "sourceStep": "\/api\/3\/workflow_steps\/fb4b811b-088c-4de1-9887-7e366552aae4",
            "label": null,
            "isExecuted": false,
            "uuid": "9c7cfa8a-8db0-4bbf-ae15-81c28336cc3c"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Quarantine Asset In FortiEDR -> Update Asset State",
            "targetStep": "\/api\/3\/workflow_steps\/6348ff62-8154-4f10-834d-4cf035b3cd7b",
            "sourceStep": "\/api\/3\/workflow_steps\/feb28d35-726c-47cc-86eb-b31a58abf27a",
            "label": null,
            "isExecuted": false,
            "uuid": "c43494ee-d211-42bd-b093-9eaba0c9a3c6"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Deploy Decoy -> Set UUID With Decoy Id",
            "targetStep": "\/api\/3\/workflow_steps\/32c66aca-f19d-4873-94ae-4c93c3856c01",
            "sourceStep": "\/api\/3\/workflow_steps\/92823c06-9d0b-4343-936a-092c9f27a8bf",
            "label": null,
            "isExecuted": false,
            "uuid": "c660a7d6-5d39-48b8-845a-586cc5d58a36"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Get Assets",
            "targetStep": "\/api\/3\/workflow_steps\/f9fe78b7-4fc1-4b60-8f85-c530507ef578",
            "sourceStep": "\/api\/3\/workflow_steps\/e957a900-935c-4de0-83cc-bdc2a2e83f73",
            "label": null,
            "isExecuted": false,
            "uuid": "d730e7e7-07ac-48b2-b3ad-e78fdc56f453"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "53ed3eae-a47a-4200-8630-e5957c5e9e3f",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "Alerts",
        "Assets",
        "ManualTrigger"
    ]
}